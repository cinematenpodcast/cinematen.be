---
const { title, thumbnail, content, canonicalURL, publishedDate, modifiedDate, author } = Astro.props;
const defaultCanonical = "https://cinematen.be/";
const finalCanonical = canonicalURL || defaultCanonical;

const defaultDescription = "Lees het laatste nieuws uit de film- en seriewereld op Cinematen.be";
const finalDescription = content || defaultDescription;

const formatDateForMeta = (dateString) => {
    if (!dateString) return null;
    const date = new Date(dateString);
    return isNaN(date.getTime()) ? null : date.toISOString();
};

const formattedPublishedDate = formatDateForMeta(publishedDate);
const formattedModifiedDate = formatDateForMeta(modifiedDate);
---
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>{title}</title>
<meta content={finalDescription} name="description" />
<meta name="google-site-verification" content="Ue-nOWKl8b37dpA_44eTIqresdKx1GF8BO1BEfSXwg4" />

<!-- Canonical URL -->
<link rel="canonical" href={finalCanonical} />

<!-- Open Graph / Twitter -->
<meta content={title} property="og:title" />
<meta content={finalDescription} property="og:description" />
<meta content={thumbnail} property="og:image" />
<meta content="article" property="og:type" />
{formattedPublishedDate && <meta content={formattedPublishedDate} property="article:published_time" />}
{formattedModifiedDate && <meta content={formattedModifiedDate} property="article:modified_time" />}
{author && <meta content={author} property="article:author" />}
<meta content={title} property="twitter:title" />
<meta content={finalDescription} property="twitter:description" />
<meta content={thumbnail} property="twitter:image" />
<meta content="summary_large_image" name="twitter:card" />

<!-- Favicon -->
<link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link href="/images/webclip.png" rel="apple-touch-icon" />

<!-- Preconnect to font origins -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&family=Rubik+Mono+One&display=swap" rel="stylesheet" />

<!-- Critical CSS (is:inline prevents Astro scoping) -->
<style is:inline>
    * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
</style>

<!-- Main stylesheet -->
<link href="/style.css" rel="stylesheet" />

<!-- Webflow touch detection -->
<script>
    document.documentElement.className += " w-mod-js";
    if ("ontouchstart" in window) document.documentElement.className += " w-mod-touch";
</script>

<!-- Google Analytics (deferred) -->
<script>
    window.addEventListener('load', function() {
        var s = document.createElement('script');
        s.src = 'https://www.googletagmanager.com/gtag/js?id=G-KZ3KYRB0T1';
        s.async = true;
        document.head.appendChild(s);
        s.onload = function() {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-KZ3KYRB0T1');
        };
    });
</script>

<!-- Structured Data for News Article -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "headline": title,
  "description": finalDescription,
  "url": finalCanonical,
  ...(formattedPublishedDate && { "datePublished": formattedPublishedDate }),
  ...(formattedModifiedDate && { "dateModified": formattedModifiedDate }),
  ...(author && { "author": { "@type": "Person", "name": author } }),
  ...(thumbnail && { "image": thumbnail }),
  "publisher": {
    "@type": "Organization",
    "name": "Cinematen",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cinematen.be/images/Cinematelogotrans.png"
    }
  }
})}></script>
