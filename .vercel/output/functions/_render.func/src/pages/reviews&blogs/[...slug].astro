---
import ReviewLayout from "../../layouts/ReviewLayout.astro";
import client from "../../../tina/__generated__/client";
import AdminReview from "../../../tina/pages/AdminReview";

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

let tinaProps;
try {
  tinaProps = await client.queries.reviews({
    relativePath: `${slug}.mdx`,
  });
} catch (e) {
   console.error(`Error fetching updated content for slug: ${slug}`, e);
   return Astro.redirect('/404');
}

const frontmatter = tinaProps.data.reviews;

// Set Cache headers for On-Demand ISR behavior (1 minute cache)
Astro.response.headers.set('Cache-Control', 'public, max-age=60, s-maxage=60');
---

<ReviewLayout frontmatter={frontmatter}>
  <AdminReview {...tinaProps} client:tina />
</ReviewLayout>
