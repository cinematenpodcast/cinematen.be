---
// Import necessary components
import BaseHead from "../../components/BaseHead.astro";
import BaseHeader from "../../components/BaseHeader.astro";
import BaseScript from "../../components/BaseScript.astro";
import BaseFooter from "../../components/BaseFooter.astro";
import NewNavmenu from "../../components/NewNavmenu.astro";
import BasePodcastBanner from "../../components/BasePodcastBanner.astro";
import BaseNieuwsItem from "../../components/BaseNieuwsItem.astro"; // Corrected component name from Niews to Nieuws
import BaseHeadExclude from "../../components/BaseHeadExclude.astro";

import { getCollection } from "astro:content";

// Function to extract text from TinaCMS rich-text body
function extractTextFromBody(body) {
    if (typeof body === 'string') {
        return body;
    }
    if (body && typeof body === 'object') {
        if (body.children && Array.isArray(body.children)) {
            const extractText = (node) => {
                if (node.type === 'text') return node.text || '';
                if (node.children && Array.isArray(node.children)) {
                    return node.children.map(extractText).join(' ');
                }
                return '';
            };
            return body.children.map(extractText).join(' ').replace(/\s+/g, ' ').trim();
        }
    }
    return '';
}

// Helper function to ensure clean ID without .mdx extension
function getCleanId(id) {
    return id ? id.replace(/\.mdx$/, '') : '';
}

const allNieuwsPostsRaw = await getCollection("nieuws");
const allNieuwsPosts = allNieuwsPostsRaw.map(post => ({
    url: `/nieuws/${getCleanId(post.id)}`,
    frontmatter: post.data,
    rawContent: () => {
        const body = post.data.body;
        const textContent = extractTextFromBody(body);
        if (textContent) {
            return textContent.substring(0, 200) + (textContent.length > 200 ? '...' : '');
        }
        return "";
    },
}));

// Define the date threshold (replace 'your_date_string' with the desired date)
const thresholdDate = new Date('2024-09-21');

// Filter posts based on the threshold date
const filteredPosts = allNieuwsPosts.filter(post => new Date(post.frontmatter.date) >= thresholdDate);

exclude_from_search: true
---

<html lang="nl">
    <head>
        <BaseHeadExclude />
    </head>
    <body class="body">
        <div class="page-wrapper">
            <NewNavmenu />
            <BaseHeader />
            <div class="content">
                <div class="container">
                    <h1 class="nieuws-title">Film & TV nieuws</h1>
                    <div class="w-layout-grid nieuws-list">
                        {filteredPosts
                            .sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime()) // Sort by date, newest to oldest
                            .map((post) => (
                                <BaseNieuwsItem
                                    key={post.url}
                                    url={post.url}
                                    title={post.frontmatter.title}
                                    thumbnail={post.frontmatter.thumbnail}
                                    date={post.frontmatter.date}
                                    content={post.rawContent}
                                />
                            ))}
                    </div>
                </div>
            </div>
            <BaseFooter />
        </div>
        <BaseScript />
    </body>
</html>
